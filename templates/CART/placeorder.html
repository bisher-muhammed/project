{% extends "user_base.html" %}
{% load static %}
{% block content %}
<style>
    body {
        font-family: 'Raleway', sans-serif;
        color: #333;
    }

    h1, h2, h3, h4, h5, h6 {
        font-family: 'Raleway', sans-serif;
        font-weight: 600;
        color: #ff6347;
        text-decoration: underline;
        text-decoration-color: #ff6334;
        font-size: 15px;
    }
    .h4{
        padding-right:10px;
    }

    

    .order-review-table {
        background-color: #f8f8f8;
        border: 1px solid #ddd;
        border-radius: 8px;
    }

    .btn-primary {
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        transition: background-color 0.3s;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }
    .box {
        border: 1px solid #ccc;
        padding: 15px;
        border-radius: 4px;
        background-color: #fff;
    }

    .breadcrumb-wrap {
        background-color: #f8f9fa;
        padding: 15px 0;
    }

    .breadcrumb {
        font-size: 14px;
        color: #6c757d;
    }

    .toggle_info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .panel-collapse {
        display: none;
    }

    .panel-body {
        margin-top: 15px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .mb-4 {
        margin-bottom: 20px;
    }

    .font-sm {
        font-size: 14px;
    }

    .custom-radio {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .custom-radio input {
        margin-right: 5px;
    }

    /* Add your other custom styles */

    /* Responsive Styles */
    @media (max-width: 767px) {
        .col-lg-6 {
            width: 100%;
        }
    }
</style>
<div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow">Home</a>
                <span></span> Shop
                <span></span> Checkout
            </div>
        </div>
    </div>
    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 mb-sm-15">
                    <div class="toggle_info">
                        <span><i class="fi-rs-user mr-10"></i><span class="text-muted">Already have an account?</span> <a
                                href="#loginform" data-bs-toggle="collapse" class="collapsed"
                                aria-expanded="false">Click here to login</a></span>
                    </div>
                    <div class="panel-collapse collapse login_form" id="loginform">
                        <div class="panel-body">
                            <p class="mb-30 font-sm">If you have shopped with us before, please enter your details
                                below. If you are a new customer, please proceed to the Billing &amp; Shipping
                                section.</p>
                            <form method="post">
                                {% csrf_token %}
                                <div class="form-group">
                                    
                                    <input type="text" name="email" placeholder="Username Or Email">
                                </div>
                                <div class="form-group">
                                    <input type="password" name="password" placeholder="Password">
                                </div>
                                <div class="login_footer form-group">
                                    <div class="chek-form">
                                        <div class="custome-checkbox">
                                            <input class="form-check-input" type="checkbox" name="checkbox" id="remember"
                                                value="">
                                            <label class="form-check-label" for="remember"><span>Remember me</span></label>
                                        </div>
                                    </div>
                                    <a href="#">Forgot password?</a>
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-md" name="login">Log in</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="toggle_info">
                        <span><i class="fi-rs-label mr-10"></i><span class="text-muted">Have a coupon?</span> <a
                                href="#coupon" data-bs-toggle="collapse" class="collapsed" aria-expanded="false">Click
                                here to enter your code</a></span>
                    </div>
                    <div class="panel-collapse collapse coupon_form " id="coupon">
                        <div class="panel-body">
                            <p class="mb-30 font-sm">If you have a coupon code, please apply it below.</p>
                            <form method="post">
                                <div class="form-group">
                                    <input type="text" placeholder="Enter Coupon Code...">
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-md" name="login">Apply Coupon</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="divider mt-50 mb-50"></div>
                </div>
            </div>

            <div class="row">
                {% comment %}
                <div class="col-md-6">
                    <div class="mb-4">
                        <h4 class="fw-bold">Billing Details</h4>
                    </div>
                    <form method="post">
                        <section class="pt-4 pb-4">
                            <div class="container">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h2 class="fw-bold">Checkout</h2>
                                        <!-- Other checkout content... -->
                                        <div class="address-section">
                                            <h3 class="fw-bold">Choose a Shipping Address</h3>
                                            {% if addresses %}
                                            <form>
                                                {% for address in addresses %}
                                                <label class="address-box d-block mb-3 p-3 border">
                                                    <input type="radio" name="shipping_address"
                                                        value="{{ address.id }}"
                                                        {% if default_address and address.id == default_address.id %}checked{% endif %}>
                                                    <div class="address-details">
                                                        <strong>{{ address.first_name }} {{ address.last_name }}</strong><br>
                                                        {{ address.address_1 }}, {{ address.city }},
                                                        {{ address.state }} {{ address.zipcode }}
                                                    </div>
                                                </label>
                                                {% endfor %}
                                            </form>
                                            {% else %}
                                            <p class="text-muted">No addresses found. Please add an address.</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <div class="mb-4">
                            <h5 class="fw-bold">Additional Information</h5>
                        </div>
                        <div class="form-group mb-4">
                            <textarea class="form-control" rows="5" placeholder="Order notes"></textarea>
                        </div>
                    </form>
                </div>
                {% endcomment %}
                <form method="post" action="{% url 'cash_on_delivery' order.id %}">
                    {% csrf_token %}
                    <!-- Modify the address section to include a link to add an address -->
                    <div class="col-12">
                        <div class="mb-4">
                            <h4 class="fw-bold">Address</h4>
                            <div class="box">
                                {% if default_address %}
                                <p>
                                    <strong>{{ default_address.first_name }} {{ default_address.last_name }}</strong><br>
                                    {{ default_address.address_1 }}, {{ default_address.city }},
                                    {{ default_address.state }} {{ default_address.zipcode }}
                                </p>
                                {% elif selected_address %}
                                <p>
                                    <strong>{{ selected_address.first_name }} {{ selected_address.last_name }}</strong><br>
                                    {{ selected_address.address_1 }}, {{ selected_address.city }},
                                    {{ selected_address.state }} {{ selected_address.zipcode }}
                                </p>
                                {% else %}
                                <p>No address found. Please <a href="{% url 'add_address' %}">add an address</a>.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    </div>
                    <div class="col-md-9">
                        <div class="order_review">
                            <div class="mb-4">
                                <h4 class="fw-bold">Your Orders</h4>
                            </div>
                            <div class="table-responsive order_table">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th colspan="2">Product</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {% for item in cart_items %}
                                        <tr>
                                            <td class="image product-thumbnail">
                                                <img src="{{ item.product.product_img1.url }}" alt="{{ item.product.product_name }}" class="img-fluid">
                                            </td>
                                            <td>
                                                <h5><a href="#" class="text-dark">{{ item.product.product_name }}</a></h5>
                                                <span class="product-qty">x {{ item.quantity }}</span>
                                            </td>
                                            <td>₹{{ item.total_price }}</td>
                                        </tr>
                                    {% endfor %}
                                    
                                    
                                        <!-- Display subtotal, shipping, and total dynamically -->
                                        <tr>
                                            <th>SubTotal</th>
                                            <td class="product-subtotal" colspan="2">₹{{ total }}</td>
                                        </tr>
                                        

                                        <tr>
                                            <th>Discount Amount</th>
                                            <td class="discount_amount" colspan="2">₹{{ discount_amount }}</td>
                                        </tr>
                                            <th>Shipping</th>
                                            <td colspan="2"><em>Free Shipping</em></td>
                                        </tr>
                                        
<!-- ... Your existing HTML code ... -->
                                        <tr>
                                            <th>Total</th>
                                            <td colspan="2" class="product-subtotal">
                                            {% if selected_coupon_code and not selected_coupon_code.is_blocked %}
                                                <span class="font-xl text-brand fw-bold" name="total" value="{{ price_value }}">₹{{ price_value }}</span>
                                            {% else %}
                                                <span class="font-xl text-brand fw-bold">₹{{ grand_total }}</span>
                                            {% endif %}
                                            </td>
                                        </tr>


                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <button id="printButton">Download</button>

            <script>
                // Add an event listener to the button
                document.getElementById('printButton').addEventListener('click', function() {
                    // Trigger the print function when the button is clicked
                    window.print();
                });
            </script>
                        <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                        <div class="payment_method">
                            <div class="mb-25">
                                <h5>Payment</h5>
                            </div>
                            <div class="payment_option"><div class="payment_option">
                          <div class="custome-radio">
                              <input class="form-check-input" required="" type="radio" name="payment_option" id="cash_on_delivery" value="cash_on_delivery">
                              <label class="form-check-label" for="cash_on_delivery">Cash On Delivery</label>
                          </div>
                      <div class="custome-radio">
                              <input class="form-check-input" required="" type="radio" name="payment_option" id="wallet" value="wallet">
                              <label class="form-check-label" for="wallet">Pay with Wallet</label>
                          </div>
                          <div class="custome-radio">
                              <input class="form-check-input" required="" type="radio" name="payment_option" id="razorpay" value="razorpay">
                              <label class="form-check-label" for="razorpay">Pay with Razorpay</label>
                          </div>
                    </div>

                                {% comment %} <div class="custome-radio">
                                    <input class="form-check-input" required="" type="radio" name="payment_option"
                                        id="exampleRadios3" checked="">
                                    <label class="form-check-label" for="exampleRadios3" data-bs-toggle="collapse"
                                        data-target="#bankTranfer" aria-controls="bankTranfer">CASH ON DELIVERY</label>
                                    <div class="form-group collapse in" id="bankTranfer">
                                        <p class="text-muted mt-5">There are many variations of passages of Lorem Ipsum
                                            available, but the majority have suffered alteration. </p>
                                    </div> {% endcomment %}
                                </div>
                                {% comment %} <div class="custome-radio">
                                <input class="form-check-input" required="" type="radio" name="payment_option"
                                    id="exampleRadios4" checked="">
                                <label class="form-check-label" for="exampleRadios4" data-bs-toggle="collapse"
                                    data-target="#checkPayment" aria-controls="checkPayment">Check Payment</label>
                                <div class="form-group collapse in" id="checkPayment">
                                    <p class="text-muted mt-5">Please send your cheque to Store Name, Store Street, Store
                                        Town, Store State / County, Store Postcode. </p>
                                </div>
                            </div>
                            <div class="custome-radio">
                                <input class="form-check-input" required="" type="radio" name="payment_option"
                                    id="exampleRadios5" checked="">
                                <label class="form-check-label" for="exampleRadios5" data-bs-toggle="collapse"
                                    data-target="#paypal" aria-controls="paypal">Paypal</label>
                                <div class="form-group collapse in" id="paypal">
                                    <p class="text-muted mt-5">Pay via PayPal; you can pay with your credit card if you
                                        don't have a PayPal account.</p>
                                </div>
                            </div> {% endcomment %}
                            </div>
                        </div>
                        {% comment %} <a href="#" class="btn btn-fill-out btn-block mt-30">Place Order</a> {% endcomment %}
                        {% comment %} <button type="submit" class="btn btn-fill-out btn-block mt-30">Place Order</button> {% endcomment %}
                        <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                      <a href="{% url 'cash_on_delivery' order.id %}" id="cash-on-delivery-btn" style="display: none;" class="btn btn-primary btn-lg btn-block">Cash on Delivery Button</a>
                      <a id="rzp-button1" class="btn btn-primary btn-lg btn-block" style="display: none;" >Pay with Razorpay</a>
                         <a href="{% url 'wallet_pay' order.id %}" id="wallet-btn" class="btn btn-primary btn-lg btn-block" style="display: none;" >Pay with Wallet</a>
            </div>
                    </div>
                </form>
                </div>
            </div>
        </div>
    </section>
</main>



<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const cashOnDeliveryBtn = document.getElementById('cash-on-delivery-btn');
    const razorpayBtn = document.getElementById('rzp-button1');
    const walletPayBtn = document.getElementById('wallet-btn');  // Add this line
    document.querySelectorAll('input[name="payment_option"]').forEach(function(radio) {
        radio.addEventListener('change', function() {
            if (this.value === 'cash_on_delivery') {
                cashOnDeliveryBtn.style.display = 'block';
                razorpayBtn.style.display = 'none';
                walletPayBtn.style.display = 'none';
            } else if (this.value === 'razorpay') {
                cashOnDeliveryBtn.style.display = 'none';
                razorpayBtn.style.display = 'block';
                walletPayBtn.style.display = 'none';
            } else if (this.value === 'wallet') {
                cashOnDeliveryBtn.style.display = 'none';
                razorpayBtn.style.display = 'none';
                walletPayBtn.style.display = 'block';
            }
        });
    });
});
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
      const cashOnDeliveryBtn = document.getElementById('cash-on-delivery-btn');
      const razorpayBtn = document.getElementById('rzp-button1');
      const walletPayBtn = document.getElementById('wallet-btn');
      document.querySelectorAll('input[name="payment_option"]').forEach(function(radio) {
          radio.addEventListener('change', function() {
              if (this.value === 'cash_on_delivery') {
                  cashOnDeliveryBtn.style.display = 'block';
                  razorpayBtn.style.display = 'none';
                  walletPayBtn.style.display = 'none';
              } else if (this.value === 'razorpay') {
                  cashOnDeliveryBtn.style.display = 'none';
                  razorpayBtn.style.display = 'block';
                  walletPayBtn.style.display = 'none';
              } else if (this.value === 'wallet_pay') {
                  cashOnDeliveryBtn.style.display = 'none';
                  razorpayBtn.style.display = 'none';
                  walletPayBtn.style.display = 'block';
              }
          });
      });
  });
</script>

<script>
    var orderAmountInPaise = {{ order.order_total|floatformat:2 }} * 100;
    var roundedAmount = Math.round(orderAmountInPaise);
    var options = {
        "key": "rzp_test_zzvnNnxalKyZJn",
        "amount": roundedAmount,
        "currency": "INR",
        "name": "Sofa",
        "description": "Purchase",
        "image": "https://example.com/your_logo",
        "order_id": "{{ payment.id }}",
        "handler": function (response) {
            if (response.razorpay_payment_id) {
                var orderid = "{{ order.id }}";
                window.location.href = '/core/confirm_razorpay_payment/' + orderid + '/';
            } else {
                alert("Payment failed or canceled!");
            }
        },
        "theme": {
            "color": "#3399cc"
        }
    };
    
    var rzp1 = new Razorpay(options);
    
    document.getElementById('rzp-button1').addEventListener('click', function (e) {
        rzp1.open();
        e.preventDefault();
    });
</script>

{% endblock content %}